{% extends "base.html" %}

{% block title %}Verificar CAPA {{ capa.reference_number }} - Alphaclin QMS{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Verificar Efetividade do CAPA</h1>
            <p class="mt-2 text-gray-600">{{ capa.reference_number }}</p>
        </div>
        <a href="{{ url_for('nonconformities.view_capa', nc_id=nc.id, capa_id=capa.id) }}"
           class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>Voltar
        </a>
    </div>

    <!-- CAPA Summary -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="text-lg font-medium text-blue-900 mb-2">Resumo do Plano Implementado</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div><span class="font-medium text-blue-800">O QUE:</span> {{ capa.what }}</div>
            <div><span class="font-medium text-blue-800">Implementado em:</span> {{ capa.implemented_at.strftime('%d/%m/%Y') if capa.implemented_at else 'N/A' }}</div>
        </div>
        {% if capa.implementation_notes %}
        <div class="mt-3">
            <span class="font-medium text-blue-800">Notas da Implementação:</span>
            <p class="text-blue-700 mt-1">{{ capa.implementation_notes }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Verification Form -->
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Avaliação de Efetividade</h3>
            <p class="mt-1 text-sm text-gray-600">Avalie se as ações tomadas foram efetivas em resolver/prevenir a não conformidade.</p>
        </div>

        <form method="POST" class="p-6 space-y-6">
            <div>
                <label for="verification_method" class="block text-sm font-medium text-gray-700 mb-2">
                    Método de Verificação
                </label>
                <textarea id="verification_method" name="verification_method" rows="3"
                          class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                          placeholder="Descreva como a efetividade foi verificada (ex: auditoria de acompanhamento, medição de indicadores, observação direta, etc.)" required></textarea>
            </div>

            <div>
                <label for="verification_result" class="block text-sm font-medium text-gray-700 mb-2">
                    Resultado da Verificação
                </label>
                <textarea id="verification_result" name="verification_result" rows="4"
                          class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                          placeholder="Descreva os resultados encontrados e se a ação foi efetiva" required></textarea>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    Avaliação de Efetividade (1-5 estrelas)
                </label>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <input id="rating-1" name="effectiveness_rating" value="1" type="radio" class="h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300">
                        <label for="rating-1" class="ml-2 text-sm text-gray-700">1 estrela - Ineficaz</label>
                    </div>
                    <div class="flex items-center">
                        <input id="rating-2" name="effectiveness_rating" value="2" type="radio" class="h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300">
                        <label for="rating-2" class="ml-2 text-sm text-gray-700">2 estrelas</label>
                    </div>
                    <div class="flex items-center">
                        <input id="rating-3" name="effectiveness_rating" value="3" type="radio" class="h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300" checked>
                        <label for="rating-3" class="ml-2 text-sm text-gray-700">3 estrelas - Parcialmente efetivo</label>
                    </div>
                    <div class="flex items-center">
                        <input id="rating-4" name="effectiveness_rating" value="4" type="radio" class="h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300">
                        <label for="rating-4" class="ml-2 text-sm text-gray-700">4 estrelas</label>
                    </div>
                    <div class="flex items-center">
                        <input id="rating-5" name="effectiveness_rating" value="5" type="radio" class="h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300">
                        <label for="rating-5" class="ml-2 text-sm text-gray-700">5 estrelas - Totalmente efetivo</label>
                    </div>
                </div>
            </div>

            <div class="flex items-center">
                <input id="close_capa" name="close_capa" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                <label for="close_capa" class="ml-2 block text-sm text-gray-900">
                    Fechar o CAPA (ação foi efetiva e não requer mais acompanhamento)
                </label>
            </div>

            <!-- Submit -->
            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                <a href="{{ url_for('nonconformities.view_capa', nc_id=nc.id, capa_id=capa.id) }}"
                   class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md transition-colors">
                    Cancelar
                </a>
                <button type="submit"
                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-md transition-colors">
                    <i class="fas fa-search mr-2"></i>Registrar Verificação
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}